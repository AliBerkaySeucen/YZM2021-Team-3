{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useMemory}from'../context/MemoryContext';import{useNavigate}from'react-router-dom';import MemoryModal from'../components/MemoryModal';import PremiumModal from'../components/PremiumModal';import apiService from'../services/api';import{toast}from'react-toastify';import'./Dashboard.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Dashboard=()=>{const{memories,connections}=useMemory();const navigate=useNavigate();const[isModalOpen,setIsModalOpen]=useState(false);const[showPremiumModal,setShowPremiumModal]=useState(false);// Initialize from localStorage to prevent flashing\nconst cachedUser=JSON.parse(localStorage.getItem('memolink_current_user')||'{}');const[isPremium,setIsPremium]=useState(cachedUser.is_premium||false);const[memoryLimit,setMemoryLimit]=useState(cachedUser.memory_limit||30);// Check premium status on mount and update if changed\nuseEffect(()=>{const checkPremiumStatus=async()=>{try{const user=await apiService.getCurrentUser();setIsPremium(user.is_premium||false);setMemoryLimit(user.memory_limit||30);}catch(error){console.error('Failed to check premium status:',error);}};checkPremiumStatus();},[]);const handleAddMemoryClick=()=>{// Check if user has reached limit\nif(!isPremium&&memories.length>=memoryLimit){setShowPremiumModal(true);}else{setIsModalOpen(true);}};const handleUpgrade=async()=>{try{await apiService.upgradeToPremium();setIsPremium(true);toast.success('Welcome to Premium! Enjoy unlimited memories!');setShowPremiumModal(false);// Update cached user data\nconst updatedUser=await apiService.getCurrentUser();localStorage.setItem('memolink_current_user',JSON.stringify(updatedUser));// Refresh page to show updated status\nwindow.location.reload();}catch(error){console.error('Upgrade failed:',error);toast.error('Failed to upgrade. Please try again.');}};const isAtLimit=!isPremium&&memories.length>=memoryLimit;// Get recently added memories (last 4)\nconst recentMemories=[...memories].sort((a,b)=>new Date(b.createdAt).getTime()-new Date(a.createdAt).getTime()).slice(0,4);return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:\"Dashboard\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-card recently-added\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"card-title\",children:\"Recently Added\"}),/*#__PURE__*/_jsx(\"div\",{className:\"recent-images\",children:recentMemories.length>0?recentMemories.map(memory=>/*#__PURE__*/_jsx(\"img\",{src:memory.image,alt:memory.title,className:\"recent-image\",onClick:()=>navigate('/album'),loading:\"lazy\",decoding:\"async\",style:{contentVisibility:'auto'}},memory.id)):/*#__PURE__*/_jsx(\"p\",{className:\"no-data\",children:\"No memories yet. Add your first memory!\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-card your-graph\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"card-title\",children:\"Your Graph\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"graph-preview\",onClick:()=>navigate('/graph'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"preview-nodes\",children:memories.slice(0,10).map((memory,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"preview-node\",style:{left:\"\".concat(index%4*25+10,\"%\"),top:\"\".concat(Math.floor(index/4)*30+20,\"%\")}},memory.id))}),memories.length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"no-data-graph\",children:\"No graph data yet\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-card statistics\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"card-title\",children:\"Statistics\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Added Memory\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:memories.length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Edge Count\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:connections.length})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-card add-memory-card\",onClick:handleAddMemoryClick,children:[/*#__PURE__*/_jsx(\"div\",{className:\"add-icon\",children:isAtLimit?'⭐':'+'}),/*#__PURE__*/_jsx(\"div\",{className:\"add-text\",children:isAtLimit?'Go Premium':'Add New Memory'})]})]}),/*#__PURE__*/_jsx(MemoryModal,{isOpen:isModalOpen,onClose:()=>setIsModalOpen(false)}),/*#__PURE__*/_jsx(PremiumModal,{isOpen:showPremiumModal,onClose:()=>setShowPremiumModal(false),onUpgrade:handleUpgrade})]});};export default Dashboard;","map":{"version":3,"names":["React","useState","useEffect","useMemory","useNavigate","MemoryModal","PremiumModal","apiService","toast","jsx","_jsx","jsxs","_jsxs","Dashboard","memories","connections","navigate","isModalOpen","setIsModalOpen","showPremiumModal","setShowPremiumModal","cachedUser","JSON","parse","localStorage","getItem","isPremium","setIsPremium","is_premium","memoryLimit","setMemoryLimit","memory_limit","checkPremiumStatus","user","getCurrentUser","error","console","handleAddMemoryClick","length","handleUpgrade","upgradeToPremium","success","updatedUser","setItem","stringify","window","location","reload","isAtLimit","recentMemories","sort","a","b","Date","createdAt","getTime","slice","className","children","map","memory","src","image","alt","title","onClick","loading","decoding","style","contentVisibility","id","index","left","concat","top","Math","floor","isOpen","onClose","onUpgrade"],"sources":["/Users/berat/YZM2021-Team-3/src/pages/Dashboard.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useMemory } from '../context/MemoryContext';\nimport { useNavigate } from 'react-router-dom';\nimport MemoryModal from '../components/MemoryModal';\nimport PremiumModal from '../components/PremiumModal';\nimport apiService from '../services/api';\nimport { toast } from 'react-toastify';\nimport './Dashboard.css';\n\nconst Dashboard: React.FC = () => {\n  const { memories, connections } = useMemory();\n  const navigate = useNavigate();\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [showPremiumModal, setShowPremiumModal] = useState(false);\n  \n  // Initialize from localStorage to prevent flashing\n  const cachedUser = JSON.parse(localStorage.getItem('memolink_current_user') || '{}');\n  const [isPremium, setIsPremium] = useState(cachedUser.is_premium || false);\n  const [memoryLimit, setMemoryLimit] = useState(cachedUser.memory_limit || 30);\n\n  // Check premium status on mount and update if changed\n  useEffect(() => {\n    const checkPremiumStatus = async () => {\n      try {\n        const user = await apiService.getCurrentUser();\n        setIsPremium(user.is_premium || false);\n        setMemoryLimit(user.memory_limit || 30);\n      } catch (error) {\n        console.error('Failed to check premium status:', error);\n      }\n    };\n    checkPremiumStatus();\n  }, []);\n\n  const handleAddMemoryClick = () => {\n    // Check if user has reached limit\n    if (!isPremium && memories.length >= memoryLimit) {\n      setShowPremiumModal(true);\n    } else {\n      setIsModalOpen(true);\n    }\n  };\n\n  const handleUpgrade = async () => {\n    try {\n      await apiService.upgradeToPremium();\n      setIsPremium(true);\n      toast.success('Welcome to Premium! Enjoy unlimited memories!');\n      setShowPremiumModal(false);\n      \n      // Update cached user data\n      const updatedUser = await apiService.getCurrentUser();\n      localStorage.setItem('memolink_current_user', JSON.stringify(updatedUser));\n      \n      // Refresh page to show updated status\n      window.location.reload();\n    } catch (error) {\n      console.error('Upgrade failed:', error);\n      toast.error('Failed to upgrade. Please try again.');\n    }\n  };\n\n  const isAtLimit = !isPremium && memories.length >= memoryLimit;\n\n  // Get recently added memories (last 4)\n  const recentMemories = [...memories]\n    .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n    .slice(0, 4);\n\n  return (\n    <div className=\"dashboard\">\n      <h1 className=\"page-title\">Dashboard</h1>\n\n      <div className=\"dashboard-grid\">\n        {/* Recently Added Section */}\n        <div className=\"dashboard-card recently-added\">\n          <h2 className=\"card-title\">Recently Added</h2>\n          <div className=\"recent-images\">\n            {recentMemories.length > 0 ? (\n              recentMemories.map(memory => (\n                <img\n                  key={memory.id}\n                  src={memory.image}\n                  alt={memory.title}\n                  className=\"recent-image\"\n                  onClick={() => navigate('/album')}\n                  loading=\"lazy\"\n                  decoding=\"async\"\n                  style={{ contentVisibility: 'auto' }}\n                />\n              ))\n            ) : (\n              <p className=\"no-data\">No memories yet. Add your first memory!</p>\n            )}\n          </div>\n        </div>\n\n        {/* Your Graph Section */}\n        <div className=\"dashboard-card your-graph\">\n          <h2 className=\"card-title\">Your Graph</h2>\n          <div className=\"graph-preview\" onClick={() => navigate('/graph')}>\n            <div className=\"preview-nodes\">\n              {memories.slice(0, 10).map((memory, index) => (\n                <div\n                  key={memory.id}\n                  className=\"preview-node\"\n                  style={{\n                    left: `${(index % 4) * 25 + 10}%`,\n                    top: `${Math.floor(index / 4) * 30 + 20}%`,\n                  }}\n                />\n              ))}\n            </div>\n            {memories.length === 0 && (\n              <p className=\"no-data-graph\">No graph data yet</p>\n            )}\n          </div>\n        </div>\n\n        {/* Statistics Section */}\n        <div className=\"dashboard-card statistics\">\n          <h2 className=\"card-title\">Statistics</h2>\n          <div className=\"stat-item\">\n            <div className=\"stat-label\">Added Memory</div>\n            <div className=\"stat-value\">{memories.length}</div>\n          </div>\n          <div className=\"stat-item\">\n            <div className=\"stat-label\">Edge Count</div>\n            <div className=\"stat-value\">{connections.length}</div>\n          </div>\n        </div>\n\n        {/* Add New Memory Section */}\n        <div className=\"dashboard-card add-memory-card\" onClick={handleAddMemoryClick}>\n          <div className=\"add-icon\">{isAtLimit ? '⭐' : '+'}</div>\n          <div className=\"add-text\">{isAtLimit ? 'Go Premium' : 'Add New Memory'}</div>\n        </div>\n      </div>\n\n      <MemoryModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} />\n      <PremiumModal\n        isOpen={showPremiumModal}\n        onClose={() => setShowPremiumModal(false)}\n        onUpgrade={handleUpgrade}\n      />\n    </div>\n  );\n};\n\nexport default Dashboard;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}